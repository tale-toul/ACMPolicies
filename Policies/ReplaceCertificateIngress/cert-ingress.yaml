apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    policy.open-cluster-management.io/standards: NIST SP 800-53
    policy.open-cluster-management.io/description: Replace SSL certificate for the Default Ingress Controller 
  name: cert-ingress-replace
  namespace: policies
spec:
  disabled: true
  policy-templates:
#Check that the secret containing the certificate is in place
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: cert-ingress-check-secret
      spec:
        pruneObjectBehavior: None
        remediationAction: inform
        severity: high
        object-templates-raw: |
          {{- $secret_data := lookup "v1" "Secret" "openshift-ingress" "ingress-tls" }}
          - complianceType: musthave
            objectDefinition:
              apiVersion: v1
              kind: Secret
              metadata:
                name: ingress-tls
                namespace: openshift-ingress
              type: kubernetes.io/tls
              data:
                tls.key: '{{ index $secret_data "tls.crt" }}'
